#![feature(test)]
extern crate chrono;
extern crate rfc822_sanitizer;
extern crate test;

use test::Bencher;
use rfc822_sanitizer::*;
use chrono::DateTime;

#[bench]
fn bench_correct_dates_with_fallback(b: &mut Bencher) {
    let valid_dates = vec![
        "Mon, 10 Jul 2017 16:00:00 -0700",
        "Mon, 17 Jul 2017 17:00:00 -0700",
        "Mon, 24 Jul 2017 16:00:00 -0700",
        "Mon, 31 Jul 2017 16:00:00 -0700",
        "Wed, 30 Aug 2017 01:30:00 -0700",
        "Wed, 20 Sep 2017 10:00:00 +0000",
        "Wed, 13 Sep 2017 10:00:00 +0000",
        "Wed,  9 Aug 2017 10:00:00 +0000",
        "Wed,  2 Aug 2017 10:00:00 +0000",
        "Wed, 26 Jul 2017 10:00:00 +0000",
        "Wed, 19 Jul 2017 10:00:00 +0000",
        "Wed, 12 Jul 2017 10:00:00 +0000",
        "Wed, 28 Jun 2017 10:00:00 +0000",
        "Wed, 21 Jun 2017 10:00:00 +0000",
        "Wed, 14 Jun 2017 10:00:00 +0000",
        "Wed,  7 Jun 2017 10:00:00 +0000",
        "Wed, 31 May 2017 10:00:00 +0000",
        "Wed, 24 May 2017 10:00:00 +0000",
        "Wed, 17 May 2017 10:00:00 +0000",
        "Wed, 10 May 2017 10:00:00 +0000",
        "Wed,  3 May 2017 10:00:00 +0000",
        "Wed, 19 Apr 2017 10:00:00 +0000",
        "Wed, 12 Apr 2017 10:00:00 +0000",
        "Wed,  5 Apr 2017 10:00:00 +0000",
        "Wed, 29 Mar 2017 10:00:00 +0000",
        "Wed, 22 Mar 2017 10:00:00 +0000",
        "Wed, 15 Mar 2017 10:00:00 +0000",
        "Wed,  8 Mar 2017 11:00:00 +0000",
        "Wed,  1 Mar 2017 11:00:00 +0000",
        "Wed, 22 Feb 2017 11:00:00 +0000",
        "Wed, 15 Feb 2017 11:00:00 +0000",
        "Wed,  8 Feb 2017 11:00:00 +0000",
        "Wed,  1 Feb 2017 11:00:00 +0000",
        "Wed, 25 Jan 2017 11:00:00 +0000",
        "Fri, 13 Jan 2017 18:38:00 +0000",
        "Wed, 20 Sep 2017 03:30:00 +0000",
        "Wed, 13 Sep 2017 03:15:00 +0000",
        "Wed,  6 Sep 2017 03:15:00 +0000",
        "Wed, 30 Aug 2017 03:15:00 +0000",
        "Wed, 23 Aug 2017 03:15:00 +0000",
        "Wed, 16 Aug 2017 03:15:00 +0000",
        "Wed,  9 Aug 2017 03:15:00 +0000",
        "Wed,  2 Aug 2017 03:00:00 +0000",
        "Tue, 11 Jul 2017 17:14:45 +0000",
        "Thu,  3 Aug 2017 06:00:00 -0400",
        "Thu, 27 Jul 2017 06:00:00 -0400",
        "Thu, 20 Jul 2017 06:00:00 -0400",
        "Thu, 13 Jul 2017 06:00:00 -0400",
        "Thu,  6 Jul 2017 06:00:00 -0400",
        "Wed, 28 Jun 2017 06:00:00 -0400",
        "Wed, 17 Jul 2013 06:00:03 -0400",
        "Wed,  2 Apr 2014 06:00:03 -0400",
        "Thu, 14 Jan 2016 06:00:03 -0400",
        "Thu, 22 Jun 2017 06:00:00 -0400",
        "Thu, 15 Jun 2017 06:00:00 -0400",
        "Wed,  7 Jun 2017 06:00:00 -0400",
        "Thu,  1 Jun 2017 06:00:00 -0400",
        "Wed, 23 Dec 2015 06:00:03 -0400",
        "Fri, 14 Feb 2014 06:00:03 -0400",
        "Wed,  4 Dec 2013 06:00:03 -0400",
        "Tue, 20 Dec 2016 06:00:00 -0400",
        "Wed, 23 Nov 2016 06:00:00 -0400",
        "Fri,  5 Aug 2016 06:00:00 -0400",
        "Thu,  9 Jun 2016 12:00:00 -0400",
        "Wed, 10 May 2017 06:00:00 -0400",
        "Wed, 22 Feb 2017 06:00:00 -0400",
        "Wed, 15 Feb 2017 06:00:00 -0400",
    ];
    b.iter(|| {
        let _foo: Vec<_> = valid_dates
            .iter()
            .map(|x| parse_from_rfc2822_with_fallback(x))
            .collect();
    })
}

#[bench]
fn bench_correct_dates_normal_parse(b: &mut Bencher) {
    let valid_dates = vec![
        "Mon, 10 Jul 2017 16:00:00 -0700",
        "Mon, 17 Jul 2017 17:00:00 -0700",
        "Mon, 24 Jul 2017 16:00:00 -0700",
        "Mon, 31 Jul 2017 16:00:00 -0700",
        "Wed, 30 Aug 2017 01:30:00 -0700",
        "Wed, 20 Sep 2017 10:00:00 +0000",
        "Wed, 13 Sep 2017 10:00:00 +0000",
        "Wed,  9 Aug 2017 10:00:00 +0000",
        "Wed,  2 Aug 2017 10:00:00 +0000",
        "Wed, 26 Jul 2017 10:00:00 +0000",
        "Wed, 19 Jul 2017 10:00:00 +0000",
        "Wed, 12 Jul 2017 10:00:00 +0000",
        "Wed, 28 Jun 2017 10:00:00 +0000",
        "Wed, 21 Jun 2017 10:00:00 +0000",
        "Wed, 14 Jun 2017 10:00:00 +0000",
        "Wed,  7 Jun 2017 10:00:00 +0000",
        "Wed, 31 May 2017 10:00:00 +0000",
        "Wed, 24 May 2017 10:00:00 +0000",
        "Wed, 17 May 2017 10:00:00 +0000",
        "Wed, 10 May 2017 10:00:00 +0000",
        "Wed,  3 May 2017 10:00:00 +0000",
        "Wed, 19 Apr 2017 10:00:00 +0000",
        "Wed, 12 Apr 2017 10:00:00 +0000",
        "Wed,  5 Apr 2017 10:00:00 +0000",
        "Wed, 29 Mar 2017 10:00:00 +0000",
        "Wed, 22 Mar 2017 10:00:00 +0000",
        "Wed, 15 Mar 2017 10:00:00 +0000",
        "Wed,  8 Mar 2017 11:00:00 +0000",
        "Wed,  1 Mar 2017 11:00:00 +0000",
        "Wed, 22 Feb 2017 11:00:00 +0000",
        "Wed, 15 Feb 2017 11:00:00 +0000",
        "Wed,  8 Feb 2017 11:00:00 +0000",
        "Wed,  1 Feb 2017 11:00:00 +0000",
        "Wed, 25 Jan 2017 11:00:00 +0000",
        "Fri, 13 Jan 2017 18:38:00 +0000",
        "Wed, 20 Sep 2017 03:30:00 +0000",
        "Wed, 13 Sep 2017 03:15:00 +0000",
        "Wed,  6 Sep 2017 03:15:00 +0000",
        "Wed, 30 Aug 2017 03:15:00 +0000",
        "Wed, 23 Aug 2017 03:15:00 +0000",
        "Wed, 16 Aug 2017 03:15:00 +0000",
        "Wed,  9 Aug 2017 03:15:00 +0000",
        "Wed,  2 Aug 2017 03:00:00 +0000",
        "Tue, 11 Jul 2017 17:14:45 +0000",
        "Thu,  3 Aug 2017 06:00:00 -0400",
        "Thu, 27 Jul 2017 06:00:00 -0400",
        "Thu, 20 Jul 2017 06:00:00 -0400",
        "Thu, 13 Jul 2017 06:00:00 -0400",
        "Thu,  6 Jul 2017 06:00:00 -0400",
        "Wed, 28 Jun 2017 06:00:00 -0400",
        "Wed, 17 Jul 2013 06:00:03 -0400",
        "Wed,  2 Apr 2014 06:00:03 -0400",
        "Thu, 14 Jan 2016 06:00:03 -0400",
        "Thu, 22 Jun 2017 06:00:00 -0400",
        "Thu, 15 Jun 2017 06:00:00 -0400",
        "Wed,  7 Jun 2017 06:00:00 -0400",
        "Thu,  1 Jun 2017 06:00:00 -0400",
        "Wed, 23 Dec 2015 06:00:03 -0400",
        "Fri, 14 Feb 2014 06:00:03 -0400",
        "Wed,  4 Dec 2013 06:00:03 -0400",
        "Tue, 20 Dec 2016 06:00:00 -0400",
        "Wed, 23 Nov 2016 06:00:00 -0400",
        "Fri,  5 Aug 2016 06:00:00 -0400",
        "Thu,  9 Jun 2016 12:00:00 -0400",
        "Wed, 10 May 2017 06:00:00 -0400",
        "Wed, 22 Feb 2017 06:00:00 -0400",
        "Wed, 15 Feb 2017 06:00:00 -0400",
    ];
    b.iter(|| {
        let _foo: Vec<_> = valid_dates
            .iter()
            .map(|x| DateTime::parse_from_rfc2822(x))
            .collect();
    })
}

#[bench]
fn bench_parse_invalid_dates_with_fallback(b: &mut Bencher) {
    let invalid_dates = vec![
        "Mon, 10 July 2017 16:00:00 PDT",
        "Mon, 17 July 2017 17:00:00 PDT",
        "Mon, 24 July 2017 16:00:00 PDT",
        "Mon, 31 July 2017 16:00:00 PDT",
        "Thu, 30 Aug 2017 1:30:00 PDT",
        "Wed, 20 Sep 2017 10:00:00 -0000",
        "Wed, 13 Sep 2017 10:00:00 -0000",
        "Wed, 09 Aug 2017 10:00:00 -0000",
        "Wed, 02 Aug 2017 10:00:00 -0000",
        "Wed, 26 Jul 2017 10:00:00 -0000",
        "Wed, 19 Jul 2017 10:00:00 -0000",
        "Wed, 12 Jul 2017 10:00:00 -0000",
        "Wed, 28 Jun 2017 10:00:00 -0000",
        "Wed, 21 Jun 2017 10:00:00 -0000",
        "Wed, 14 Jun 2017 10:00:00 -0000",
        "Wed, 07 Jun 2017 10:00:00 -0000",
        "Wed, 31 May 2017 10:00:00 -0000",
        "Wed, 24 May 2017 10:00:00 -0000",
        "Wed, 17 May 2017 10:00:00 -0000",
        "Wed, 10 May 2017 10:00:00 -0000",
        "Wed, 03 May 2017 10:00:00 -0000",
        "Wed, 19 Apr 2017 10:00:00 -0000",
        "Wed, 12 Apr 2017 10:00:00 -0000",
        "Wed, 05 Apr 2017 10:00:00 -0000",
        "Wed, 29 Mar 2017 10:00:00 -0000",
        "Wed, 22 Mar 2017 10:00:00 -0000",
        "Wed, 15 Mar 2017 10:00:00 -0000",
        "Wed, 08 Mar 2017 11:00:00 -0000",
        "Wed, 01 Mar 2017 11:00:00 -0000",
        "Wed, 22 Feb 2017 11:00:00 -0000",
        "Wed, 15 Feb 2017 11:00:00 -0000",
        "Wed, 08 Feb 2017 11:00:00 -0000",
        "Wed, 01 Feb 2017 11:00:00 -0000",
        "Wed, 25 Jan 2017 11:00:00 -0000",
        "Fri, 13 Jan 2017 18:38:00 -0000",
        "Wed, 20 Sep 2017 03:30:00 -0000",
        "Wed, 13 Sep 2017 03:15:00 -0000",
        "Wed, 06 Sep 2017 03:15:00 -0000",
        "Wed, 30 Aug 2017 03:15:00 -0000",
        "Wed, 23 Aug 2017 03:15:00 -0000",
        "Wed, 16 Aug 2017 03:15:00 -0000",
        "Wed, 09 Aug 2017 03:15:00 -0000",
        "Wed, 02 Aug 2017 03:00:00 -0000",
        "Tue, 11 Jul 2017 17:14:45 -0000",
        "Thu, 03 August 2017 06:00:00 -0400",
        "Thu, 27 July 2017 06:00:00 -0400",
        "Thu, 20 July 2017 06:00:00 -0400",
        "Thu, 13 July 2017 06:00:00 -0400",
        "Thu, 06 July 2017 06:00:00 -0400",
        "Thu, 28 June 2017 06:00:00 -0400",
        "Thu, 17 Jul 2013 06:00:03 -0400",
        "Thu, 02 Apr 2014 06:00:03 -0400",
        "Wed, 14 Jan 2016 06:00:03 -0400",
        "Thu, 22 June 2017 06:00:00 -0400",
        "Thu, 15 June 2017 06:00:00 -0400",
        "Thu, 7 June 2017 06:00:00 -0400",
        "Thu, 1 June 2017 06:00:00 -0400",
        "Thu, 23 Dec 2015 06:00:03 -0400",
        "Thu, 14 Feb 2014 06:00:03 -0400",
        "Thu, 04 Dec 2013 06:00:03 -0400",
        "Thu, 20 Dec 2016 06:00:00 -0400",
        "Thu, 23 Nov 2016 06:00:00 -0400",
        "Thu, 05 Aug 2016 06:00:00 -0400",
        "Fri, 09 Jun 2016 12:00:00 -0400",
        "Thu, 10 May 2017 06:00:00 -0400",
        "Thu, 22 Feb 2017 06:00:00 -0400",
        "Thu, 15 Feb 2017 06:00:00 -0400",
    ];
    b.iter(|| {
        let _foo: Vec<_> = invalid_dates
            .iter()
            .map(|x| parse_from_rfc2822_with_fallback(x))
            .collect();
    })
}
